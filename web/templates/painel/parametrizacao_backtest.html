{% extends "public/base.html" %}

{% block title %}ParametrizaÃ§Ã£o do Backtest - Insight Futures{% endblock %}
{% block page_key %}parametrizacao-backtest{% endblock %}

{% block body_wrapper %}
<main data-page="parametrizacao-backtest">
<section id="parametrizacao-backtest" class="container-if section">

  <h2 class="text-2xl md:text-3xl font-semibold text-gradient mb-6">
    âš™ï¸ ParametrizaÃ§Ã£o do Backtest baseado nas EstatÃ­sticas
  </h2>

  <!-- GRID DOS 3 BLOCOS -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <!-- ğŸŸ¢ AtivaÃ§Ã£o -->
    <div class="card p-6 relative">
      <h3 class="card__title mb-2 flex items-center">
        ğŸŸ¢ Ativar a automaÃ§Ã£o quando:
        <div class="relative group ml-2 cursor-pointer">
          <span class="text-gray-400">â„¹ï¸</span>
          <div class="absolute bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-3 py-2 w-72 shadow-lg z-50">
            <strong>AtivaÃ§Ã£o:</strong><br>
            Quando a automaÃ§Ã£o estÃ¡ desligada, ela serÃ¡ ativada conforme o drawdown atual atingir o limite configurado.<br><br>
            - Se escolher "mais severo", ativa quando o drawdown for mais negativo.<br>
            - Se escolher "menos severo", ativa quando o drawdown for menos negativo.<br><br>
            A margem ajusta esse limite para ser mais ou menos agressivo.
          </div>
        </div>
      </h3>

      <label class="block text-sm mb-1 text-gray-300">Margem sobre o limite de drawdown (%):</label>
      <input type="number" name="ativacao_percentual" value="5"
             class="w-full p-2 mb-2 rounded bg-[#1E293B] border border-gray-500 text-white">

      <label class="block text-sm mb-1 text-gray-300">Base de comparaÃ§Ã£o:</label>
      <select name="ativacao_base" class="w-full p-2 mb-2 rounded bg-[#1E293B] border border-gray-500 text-white" style="position: initial;">
        <option value="media_drawdown">ğŸ“‰ MÃ©dia dos Drawdowns</option>
        <option value="percentil25_drawdown">ğŸ“‰ Percentil 25 dos Drawdowns</option>
      </select>

      <label class="block text-sm mb-1 text-gray-300">CondiÃ§Ã£o:</label>
      <select name="comparador_ativacao" class="w-full p-2 rounded bg-[#1E293B] border border-gray-500 text-white" style="position: initial;">
        <option value="menor">ğŸ”½ Drawdown mais severo (mais negativo) que o limite</option>
        <option value="maior">ğŸ”¼ Drawdown menos severo (menos negativo) que o limite</option>
      </select>
    </div>

    <!-- ğŸŸ¡ Pausa -->
    <div class="card p-6 relative">
      <h3 class="card__title mb-2 flex items-center">
        ğŸŸ¡ Pausar automaÃ§Ã£o quando:
        <div class="relative group ml-2 cursor-pointer">
          <span class="text-gray-400">â„¹ï¸</span>
          <div class="absolute bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-3 py-2 w-72 shadow-lg z-50">
            <strong>Pausa:</strong><br>
            Quando a automaÃ§Ã£o estÃ¡ ativa, ela pode ser pausada se atingir um lucro acima ou abaixo do limite configurado.<br>
            OpÃ§Ãµes:<br>
            - RecuperaÃ§Ã£o total do drawdown: para quando o caixa volta a zero.<br>
            - Alvo simÃ©trico: para quando atinge o dobro da distÃ¢ncia do drawdown.<br>
            - Encerrar apÃ³s amortizaÃ§Ã£o do valor ativado: para quando o sistema devolver exatamente o valor da ativaÃ§Ã£o em amortizaÃ§Ã£o, garantindo lucro real.
          </div>
        </div>
      </h3>

      <label class="block text-sm mb-1 text-gray-300">Margem sobre o limite de lucro (%):</label>
      <input type="number" name="pausa_percentual" value="15"
             class="w-full p-2 mb-2 rounded bg-[#1E293B] border border-gray-400 text-white">

      <label class="block text-sm mb-1 text-gray-300">Base de comparaÃ§Ã£o:</label>
      <select name="pausa_base" class="w-full p-2 mb-2 rounded bg-[#1E293B] border border-gray-500 text-white" style="position: initial;">
        <option value="media_lucro">ğŸ“ˆ MÃ©dia dos Lucros</option>
        <option value="percentil75_lucro">ğŸ“ˆ Percentil 75 dos Lucros</option>
        <option value="valor_recuperacao">ğŸ¯ RecuperaÃ§Ã£o Total do Drawdown</option>
        <option value="alvo_simetrico">ğŸ” Alvo SimÃ©trico</option>
        <option value="amortizacao_entrada">ğŸ’° Encerrar apÃ³s amortizaÃ§Ã£o do valor ativado</option>
      </select>

      <label class="block text-sm mb-1 text-gray-300">CondiÃ§Ã£o:</label>
      <select name="comparador_pausa" class="w-full p-2 rounded bg-[#1E293B] border border-gray-500 text-white" style="position: initial;">
        <option value="maior">ğŸ“ˆ Lucro MAIOR que o limite configurado</option>
        <option value="menor">ğŸ“‰ Lucro MENOR que o limite configurado</option>
      </select>

      <label class="block text-sm mb-1 text-gray-300 mt-2 flex items-center gap-2">
        <input type="checkbox" id="encerrar_ciclo" checked class="accent-lime-400">
        Encerrar automaticamente ao fim do ciclo da simulaÃ§Ã£o
      </label>
    </div>

    <!-- ğŸ”´ DesativaÃ§Ã£o -->
    <div class="card p-6 relative">
      <h3 class="card__title mb-2 flex items-center">
        ğŸ”´ Desativar automaÃ§Ã£o quando:
        <div class="relative group ml-2 cursor-pointer">
          <span class="text-gray-400">â„¹ï¸</span>
          <div class="absolute bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-3 py-2 w-72 shadow-lg z-50">
            <strong>DesativaÃ§Ã£o:</strong><br>
            A automaÃ§Ã£o Ã© desligada em situaÃ§Ãµes crÃ­ticas de risco (drawdown extremo). Ela permanecerÃ¡ desligada atÃ© que uma nova condiÃ§Ã£o de ativaÃ§Ã£o seja atingida.
          </div>
        </div>
      </h3>

      <label class="block text-sm mb-1 text-gray-300">Margem sobre o drawdown mÃ¡ximo (%):</label>
      <input type="number" name="desativacao_percentual" value="15"
             class="w-full p-2 mb-2 rounded bg-[#1E293B] border border-gray-500 text-white">

      <label class="block text-sm mb-1 text-gray-300">Base de comparaÃ§Ã£o:</label>
      <select name="desativacao_base" class="w-full p-2 mb-2 rounded bg-[#1E293B] border border-gray-500 text-white" style="position: initial;">
        <option value="maior_drawdown">ğŸ’£ Maior Drawdown HistÃ³rico</option>
      </select>

      <label class="block text-sm mb-1 text-gray-300">CondiÃ§Ã£o:</label>
      <select name="comparador_desativacao" class="w-full p-2 rounded bg-[#1E293B] border border-gray-500 text-white" style="position: initial;">
        <option value="menor">ğŸ”½ Drawdown mais severo (mais negativo) que o limite</option>
        <option value="maior">ğŸ”¼ Drawdown menos severo (menos negativo) que o limite</option>
      </select>
    </div>

  </div>

  <!-- BotÃ£o -->
  <div class="mt-6 text-right">
    <button id="rodarBacktest" class="bg-[#B6E21F] text-black px-6 py-2 rounded-lg font-semibold hover:bg-yellow-400 transition">
      ğŸ“Š Rodar SimulaÃ§Ã£o
    </button>
    <p id="resumo_ciclo" class="mt-4 text-sm text-gray-300"></p>
  </div>

  <!-- INSIGHT DO BACKTEST - DR. DRAWDOWN -->
  <div id="blocoInsightBacktest" class="mt-8 flex items-start bg-[#0F172A] bg-opacity-60 p-6 rounded-2xl shadow-xl text-white hidden">
    <img src="{{ url_for('static', filename='img/dr_drawdown_sorriso_icon.png') }}"
         alt="Dr. Drawdown" class="w-auto h-72 mr-6 rounded-full border-2 border-lime-500">
    <div class="bg-[#1B263B] text-gray-200 p-4 rounded-xl w-full relative">
      <h3 class="text-lime-400 font-bold mb-2 text-lg">ğŸ“Š Insight do Dr. Drawdown sobre o Backtest:</h3>
      <p id="textoInsightBacktest" class="text-sm leading-relaxed text-gray-300"></p>
    </div>
  </div>

</section>
</main>
{% endblock %}

{% block scripts %}{% endblock %}